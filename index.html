<!DOCTYPE HTML>
<!--
SImple line making tool to make it easier for speed graphs and stuff

Eric Lemieux, 2014
-->
<html>
	<head>
		<title>Line Plotter</title>
	</head>
	
	<body>
		<div>
			<canvas id="canv" width="750" height="750" style="border:1px solid #000000;"></canvas>
			
			<div style="text-align:left;">
				<h2>Line Plotter thing</h2>
				<button onClick="saveToFile()">Save as JSON</button>
			</div>
			
			<div id="results">
			
			</div>
		</div>
		
		<script>
			var c = document.getElementById("canv");
			c.addEventListener("mousedown", doMouseDown, false);
			var ctx = c.getContext("2d");
			ctx.fillStyle = "#000000";
			
			var pointList = []
			
			function doMouseDown(event){
				//Get the location of the click
				var x = event.pageX;
				var y = event.pageY;
				
				//Append the array with the new data
				pointList.push([x,y]);
				
				//Draw onto the canvas
				ctx.fillRect(pointList[pointList.length-1][0], pointList[pointList.length-1][1], 5, 5);
				
				//Draw the connecting line
				if(pointList.length >= 2){
					ctx.moveTo(pointList[pointList.length-2][0], pointList[pointList.length-2][1]);
					ctx.lineTo(pointList[pointList.length-1][0], pointList[pointList.length-1][1]);
					ctx.stroke();
				}
			}
			
			function onInitFs(fs){
				fs.root.getFile('points.json', {create: true}, function(fileEntry){
					fileEntry.createWriter(function(fileWriter){
					
						fileWriter.onwriteend = function(e){
							console.log('write complete');
						};
						
						fileWriter.onerror = function(e){
							console.log('write failed: ' + e.toString());
						};
						
						var blob = new Blob(['stuff'], {type: 'text/plain'});
						
						fileWriter.write(blob);
						
					}, errorHandler);
				}, errorHandler);
			}
			
			function errorHandler(e){
				var msg = '';
				
				switch(e.code){
					case FileError.QUOTA_EXCEEDED_ERR:
						msg += "quota exceeded error";
						break;
					case FileError.NOT_FOUND_ERR:
						msg += "not found";
						break;
					case FileError.SECURITY_ERR:
						msg += "security error";
						break;
					case FileError.INVALID_MODIFICATION_ERR:
						msg += "invalid modification error";
						break;
					case FileError.INVALID_STATE_ERR:
						msg += "invalid state error";
						break;
					default:
						msg += "unknown error";
						break;
				};
				
				alert(msg);
			}
			
			function saveToFile(){
				//var json = JSON.stringify(pointList);
				//localStorage.setItem('pointList', JSON.stringify(pointList));
				
				/*//Display in the html				
				var resultDiv = document.getElementById("results");
				resultDiv.innerHTML = ""
				resultDiv.innerHTML += localStorage.getItem('pointList') + "\n";*/
								
				//window.requestFileSystem(0,0,0,0);
				
				window.webkitRequestFileSystem(window.TEMPORARY, 5 * 1024 * 1024, onInitFs, errorHandler);
			}
		</script>
	</body>
</html>