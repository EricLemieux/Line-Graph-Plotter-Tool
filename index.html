<!DOCTYPE HTML>
<!--
SImple line making tool to make it easier for speed graphs and stuff

Eric Lemieux, 2014
-->
<html>
	<head>
		<title>Line Plotter</title>
	</head>
	
	<body>
		<div>
			<canvas id="canv" width="750" height="750" style="border:1px solid #000000;"></canvas>
			
			<div style="text-align:left;">
				<h2>Line Plotter thing</h2>
				
				<ul>
					<li><button onClick="saveToFile()">Save as JSON</button></li>
					<li><button onClick="resetPointList()">Reset point list</button></li>
				</ul>
				<a id="download" href=""></a>
			</div>
			
			<div id="results">
			
			</div>
		</div>
		
		<script>
			var c = document.getElementById("canv");
			c.addEventListener("mousedown", doMouseDown, false);
			var ctx = c.getContext("2d");
			ctx.fillStyle = "#000000";
			
			var bbSize = 20.0;
			
			var activeIndex = 1;
			
			var pointList = []
			pointList.push([0.0,750.0]);
			pointList.push([750.0,0.0]);
			drawPoints();
			
			function doMouseDown(event){
				//Get the location of the click
				var x = event.pageX;
				var y = event.pageY;
				
				var selectionExists = false;
				
				for(var i = 0; i < pointList.length; ++i)
				{
					if(pointList[i][0] > x - bbSize && pointList[i][0] < x + bbSize &&
						pointList[i][1] > y - bbSize && pointList[i][1] < y + bbSize)
					{
						selectionExists = true;
						
						activeIndex = i+1;
					}
				}
				
				//Append the array with the new data
				if(selectionExists == false)
				{
					pointList.splice(activeIndex, 0, [x,y]);
					activeIndex++;
				}
				
				drawPoints();
			}
			
			function drawPoints(){
				//Clear the context for redrawing
				ctx.clearRect( 0, 0, c.width, c.height);
				ctx.beginPath();
				
				for(var i = 1; i < pointList.length; ++i){
					if(i == activeIndex-1){
						ctx.fillStyle = 'red';
					}else{
						ctx.fillStyle = 'black';
					}
				
					//Draw onto the canvas
					ctx.fillRect(pointList[i][0], pointList[i][1], 10, 10);
					
					//Draw the connecting line
					if(pointList.length >= 2){
						ctx.moveTo(pointList[i-1][0], pointList[i-1][1]);
						ctx.lineTo(pointList[i][0], pointList[i][1]);
						ctx.stroke();
					}
				}
			}
			
			function saveToFile(){
				//Normalize the points data
				for(var i = 0;  i < pointList.length; ++i){
					pointList[i][0] = pointList[i][0] / 750.0;
					pointList[i][1] = pointList[i][1] / 750.0;
					
					//Flip the y-axis
					pointList[i][1] = 1.0 - pointList[i][1];
				}
			
				var myBlob = new Blob([JSON.stringify(pointList)], {type: 'application/json'});
				
				var a = document.getElementById("download");
				a.href = URL.createObjectURL(myBlob);
				a.download = 'filename.json';
				a.textContent = 'Download file! (Right click and save as)';
			}
			
			function resetPointList(){
				activeIndex = 1;
				pointList = []
				pointList.push([0.0,750.0]);
				pointList.push([750.0,0.0]);
				drawPoints();
			}
		</script>
	</body>
</html>